<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <TITLE>OTL 4.0, Example 24 (MS SQL Server stored procedure)</TITLE>
   <META NAME="Author" CONTENT="Sergei Kuchin">
   <META NAME="GENERATOR" CONTENT="Mozilla/3.03Gold (Win95; I) [Netscape]">
   <META NAME="KeyWords" CONTENT="OTL, Oracle, ODBC, DB2, CLI, database API, C++, Template Library">
</HEAD>
<BODY>

<H1 ALIGN=CENTER>OTL 4.0, Example 24 (MS SQL Server stored procedure call)</H1>

<H1><A NAME="example1"></A>Example 24 (MS SQL Server stored procedure call)</H1>

<P>This example demonstrates a stored procedure call.</P>

<H2>Source Code</H2>

<PRE>#include &lt;iostream&gt;
using namespace std;

#include &lt;stdio.h&gt;
#define OTL_ODBC // Compile OTL 4.0/ODBC
#include &lt;otlv4.h&gt;

<A HREF="otl3_connect_class.htm">otl_connect</A> db; // connect object

void stored_proc(void)
// invoking stored procedure
{ 
 <A HREF="otl3_stream_class.htm">otl_stream</A> o(1, // buffer size should be equal to 1 in case of stored procedure call
              &quot;{call my_proc(&quot;
              &quot; :A&lt;int,inout&gt;, &quot;
              &quot; :B&lt;char[31],out&gt;, &quot;
              &quot; :C&lt;char[31],in&gt; &quot;
              &quot;)}&quot;,
                 // stored procedure call
              db // connect object
             );

 o.<A HREF="otl3_stream_class.htm#set_commit">set_commit</A>(0); // set stream auto-commit off since
                  // the stream does not generate transaction

 o&lt;&lt;1&lt;&lt;&quot;Test String1&quot;; // assigning :1 = 1, :3 = &quot;Test String1&quot;

 int a;
 char b[31];

 o&gt;&gt;a&gt;&gt;b;
 cout&lt;&lt;&quot;A=&quot;&lt;&lt;a&lt;&lt;&quot;, B=&quot;&lt;&lt;b&lt;&lt;endl;

}

int main()
{
 otl_connect::otl_initialize(); // initialize ODBC environment
 try{
  db.rlogon(&quot;uid=scott;pwd=tiger;dsn=mssql&quot;); // connect to ODBC
  otl_cursor::direct_exec
   (db,
    &quot;CREATE PROCEDURE my_proc &quot;
    &quot;  @A int out, &quot;
    &quot;  @B varchar(60) out, &quot;
    &quot;  @C varchar(60) &quot;
    &quot;AS &quot;
    &quot;BEGIN &quot;
    &quot;  SELECT @A=@A+1&quot;
    &quot;  SELECT @B=@C &quot;
    &quot;END&quot;
   );  // create stored procedure

  stored_proc(); // invoking stored procedure
 }
 catch(otl_exception&amp; p){ // intercept OTL exceptions
  cerr&lt;&lt;p.msg&lt;&lt;endl; // print out error message
  cerr&lt;&lt;p.code&lt;&lt;endl; // print out error code
  cerr&lt;&lt;p.var_info&lt;&lt;endl; // print out the variable that caused the error
  cerr&lt;&lt;p.sqlstate&lt;&lt;endl; // print out SQLSTATE message
  cerr&lt;&lt;p.stm_text&lt;&lt;endl; // print out SQL that caused the error
 }
 db.logoff(); // disconnect from the data source
 return 0;
} 


</PRE>

<H2>Output</H2>

<PRE> A=2, B=Test String1





<HR WIDTH="100%"></PRE>

<CENTER><P><A HREF="otl3_examples.htm">Examples</A> <A HREF="otl3.htm">Contents</A>
<A HREF="home.htm">Go Home</A> </P></CENTER>

<P>Copyright &copy; 1996, 2007, Sergei Kuchin, email: <A HREF="mailto:skuchin@ispwest.com">skuchin@ispwest.com</A>,
<A HREF="mailto:skuchin@gmail.com">skuchin@yahogmail</A>
<SCRIPT Language="JavaScript">
<!-- hide from old browsers
 var modDate = new Date(document.lastModified)
 document.write("<i> Last Updated:</i> " + (modDate.getMonth()+1) + "/" + 
                modDate.getDate() + "/" + "0"+(modDate.getYear())%100+".");
 //-->
 </SCRIPT>
.</P>

<P><I>Permission to use, copy, modify and redistribute this document for
any purpose is hereby granted without fee, provided that the above copyright
notice appear in all copies. </I></P>

</BODY>
</HTML>
