<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
   <TITLE>OTL 4.0, Example 104 (#define OTL_UNCAUGHT_EXCEPTION_ON, ODBC / MS SQL Server)</TITLE>
   <META NAME="Author" CONTENT="Sergei Kuchin">
   <META NAME="GENERATOR" CONTENT="Mozilla/3.03Gold (Win95; I) [Netscape]">
   <META NAME="KeyWords" CONTENT="OTL, Oracle, ODBC, DB2, CLI, database API, C++, Template Library">
</HEAD>
<BODY>

<H1 ALIGN=CENTER>OTL 4.0, Example 104 (#define OTL_EXENDED_EXCEPTION, ODBC
/ MS SQL Server)</H1>

<H1><FONT SIZE=+2>Example 104 (#define OTL_EXTENDED_EXCPTION, ODBC / SQM
SQL Server)</FONT></H1>

<P>This example demonstrates #define <A HREF="otl3_compile.htm#OTL_UNCAUGHT_EXCEPTION_ON">OTL_EXTENDED_EXCEPTION.</A>
See also problem <A HREF="otl3_prob.htm#prob47">47</A>, and the otl_exception's
<A HREF="otl3_exception_class.htm#EXTENDED">extended fields</A>.</P>

<H2>Source Code</H2>

<PRE>#include &lt;iostream&gt;
using namespace std;

#include &lt;stdio.h&gt;</PRE>

<PRE>#define OTL_ODBC // Compile OTL 4.0/ODBC
#define OTL_EXTENDED_EXCEPTION // Enable extended field in otl_exception
#include &lt;otlv4.h&gt; // include the OTL 4.0 header file

<A HREF="otl3_connect_class.htm">otl_connect</A> db; // connect object

void insert()
// insert rows into table
{ 
 <A HREF="otl3_stream_class.htm">otl_stream</A> o(10, // buffer size
              &quot;insert into test_tab values(:f1&lt;int&gt;,:f2&lt;char[31]&gt;&quot;, 
                 // SQL statement
              db // connect object
             );

 o&lt;&lt;100&lt;&lt;&quot;Row 100&quot;;

}

int main()
{
 <A HREF="otl3_connect_class.htm">otl_connect::otl_initialize</A>(); // initialize ODBC environment
 try{

  db.rlogon(&quot;scott/tiger@mssql&quot;); // connect to MS&nbsp;SQL Server

  <A HREF="otl3_const_sql.htm">otl_cursor::direct_exec
</A>   (
    db,
    &quot;drop table test_tab&quot;,
    otl_exception::disabled // disable OTL exceptions
   ); // drop table

  <A HREF="otl3_const_sql.htm">otl_cursor::direct_exec
</A>   (
    db,
    &quot;create table test_tab(f1 int, f2 varchar(30))&quot;
    );  // create table

  insert(); // insert records into table

 }

 catch(<A HREF="otl3_exception_class.htm">otl_exception</A>&amp; p){ // intercept OTL exceptions
  cerr&lt;&lt;p.msg&lt;&lt;endl; // print out error message
  cerr&lt;&lt;p.stm_text&lt;&lt;endl; // print out SQL that caused the error
  cerr&lt;&lt;p.sqlstate&lt;&lt;endl; // print out SQLSTATE info.
  cerr&lt;&lt;p.var_info&lt;&lt;endl; // print out the variable that caused the error
  if(p.arr_len&gt;0){ // checking if the extended fields were populated
   for(int j=0;j&lt;p.arr_len;++j){
    cout&lt;&lt;&quot;MSG[&quot;&lt;&lt;j&lt;&lt;&quot;]=&quot;&lt;&lt;p.msg_arr[j]&lt;&lt;endl; // message array
    cout&lt;&lt;&quot;SQLSTATE[&quot;&lt;&lt;j&lt;&lt;&quot;]=&quot;&lt;&lt;p.sqlstate_arr[j]&lt;&lt;endl; // sqlstate array
    cout&lt;&lt;&quot;CODE[&quot;&lt;&lt;j&lt;&lt;&quot;]=&quot;&lt;&lt;p.code_arr[j]&lt;&lt;endl; // code array
   }
  }
 }

 db.logoff(); // disconnect from MS SQL&nbsp;Server

 return 0;

}
</PRE>

<H2>Output</H2>

<PRE>[Microsoft][ODBC SQL Server Driver][SQL Server]Line 1: Incorrect syntax near '@P2'.
insert into test_tab values(?       ,?            
42000

MSG[0]=[Microsoft][ODBC SQL Server Driver][SQL Server]Line 1: Incorrect syntax near '@P2'.
SQLSTATE[0]=42000
CODE[0]=170
MSG[1]=[Microsoft][ODBC SQL Server Driver][SQL Server]Statement(s) could not be prepared.
SQLSTATE[1]=42000
CODE[1]=8180










<HR WIDTH="100%"></PRE>

<CENTER><P><A HREF="otl3_examples.htm">Examples</A> <A HREF="otl3.htm">Contents</A>
<A HREF="home.htm">Go Home</A> </P></CENTER>

<P>Copyright &copy; 1996, 2007, Sergei Kuchin, email: <A HREF="mailto:skuchin@ispwest.com">skuchin@ispwest.com</A>,
<A HREF="mailto:skuchin@gmail.com">skuchin@gmail.com</A>. <SCRIPT Language="JavaScript"><!-- hide from oldgmailsers
 var modDate = new Date(document.lastModified)
 document.write("<i> Last Updated:</i> " + (modDate.getMonth()+1) + "/" + 
                modDate.getDate() + "/" + "0"+(modDate.getYear())%100+".");
 //-->
 </SCRIPT></P>

<P><I>Permission to use, copy, modify and redistribute this document for
any purpose is hereby granted without fee, provided that the above copyright
notice appear in all copies. </I></P>

</BODY>
</HTML>
